if first task:
    connect to start
elif last task
    connect to end
else:
    # its middle task
    if is_parallel(this, next):
        para.append(this)
    elif is_parallel(prev, this):
        para.append(this)
        build parallel construct
        empty = end of parallel construct
        prev_is_empty = True
        clear para
    elif prev_is_empty:
        connect empty to this
        pre_is_empty = False
    else:
        connect prev to this